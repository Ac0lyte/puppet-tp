#!/bin/bash
# Script generated by Puppet. It's executed when you run:
# puppi info <%= @title %> 
#
# Sources common header for Puppi scripts
. <%= scope.lookupvar('::puppi::params::scriptsdir') %>/header || exit 10

<% if @settings[package_name] != "" -%>
# Show packages info
echo_title "$HOSTNAME - <%= @title %>: Packages Installed: <% @settings[package_name].each do |item| %><%= item %><% end %>"
<% @settings[package_name].each do |item| -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_query') %> <%= item %>"
<% if @verbose == true -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_list') %> <%= item %>"
<% else -%>
show_command "<%= scope.lookupvar('::puppi::params::info_package_list') %> <%= item %> | egrep '(/bin|^/etc|/sbin|log$)'"
<% end -%>
<% end -%>
<% end -%>

<% if @settings[config_file_path] != "" -%>
# Show config info
echo_title "$HOSTNAME - <%= @title %>: Configuration Files managed: <% @settings[config_file_path].each do |item| %><%= item %><% end %>"
<% @settings[config_file_path].each do |item| -%>
<% if @verbose == true -%>
show_command "cat <%= item %>"
<% else -%> 
show_command "head <%= item %>"
<% end -%>
<% end -%>
<% end -%>

<% if @settings[data_dir_path] != "" -%>
# Show data dir
echo_title "$HOSTNAME - <%= @title %>: Application data are in: <% @settings[data_dir_path].each do |item| %><%= item %><% end %>"
<% @settings[data_dir_path].each do |item| -%>
show_command "ls -latr <%= item %>"
show_command "df <%= item %>"
<% end -%>
<% end -%>

<% if @settings[log_dir_path] != "" -%>
# Show log dir
echo_title "$HOSTNAME - <%= @title %>: Logs are in: <% @settings[log_dir_path].each do |item| %><%= item %><% end %>"
<% @settings[log_dir_path].each do |item| -%>
show_command "ls -latr <%= item %>"
<% end -%>
<% end -%>

<% if @settings[log_file_path] != "" -%>
# Show logs
echo_title "$HOSTNAME - <%= @title %>: Last log entries: <% @settings[log_file_path].each do |item| %><%= item %><% end %>"
<% @settings[log_file_path].each do |item| -%>
<% if @verbose == true -%>
show_command "tail -30 <%= item %>"
<% else -%>
show_command "tail -10 <%= item %>"
<% end -%>
<% end -%>
<% end -%>

<% if @settings[service_name] != "" -%>
# Show service info
echo_title "$HOSTNAME - <%= @title %>: Services: <% @settings[service_name].each do |item| %><%= item %><% end %>"
<% @settings[service_name].each do |item| -%>
show_command "/etc/init.d/<%= item %> status"
<% end -%>
<% if @verbose == "yes" -%>
show_command "ps -adef | grep <%= @settings[process_name] %> | grep -v grep"
<% else -%>
show_command "ps -adef | grep <%= @settings[process_name] %> | grep -v grep | head -20"
<% end -%>
<% @port.each do |mport| -%>
<% if @verbose == "yes" -%>
show_command "netstat -natup | grep ':<%= mport %> '"
<% else -%>
show_command "netstat -natup | grep ':<%= mport %> ' | head -20"
<% end -%>
<% end -%>
<% end -%>

<% if @settings[info_commands] -%>
echo_title "$HOSTNAME - <%= @title %>: Info Commands"
<% @settings[info_commands].each do |cmd| %>show_command "<%= cmd %>"
<% end -%>
<% end -%>


